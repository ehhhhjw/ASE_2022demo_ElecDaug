{"remainingRequest":"E:\\LidarPlatformFrontend-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\LidarPlatformFrontend-main\\src\\components\\page\\SelfInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\LidarPlatformFrontend-main\\src\\components\\page\\SelfInfo.vue","mtime":1636256586346},{"path":"E:\\LidarPlatformFrontend-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\LidarPlatformFrontend-main\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\LidarPlatformFrontend-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\LidarPlatformFrontend-main\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport qs from 'qs';\nimport fileDownload from 'js-file-download';\nexport default {\n    data() {\n        return {\n            Info: [],\n            name: '',\n            role: '',\n            editDialogVisible: false,\n            editForm: {\n                username: '',\n                new_password: '',\n                new_nickname: '',\n                new_user_group: ''\n            },\n            editFormRules: {\n                username: [\n                    { required: true, message: '请输入用户名', trigger: 'blur' },\n                    {\n                        min: 3,\n                        max: 10,\n                        message: '用户名的长度在3~10个字符之间',\n                        trigger: 'blur'\n                    }\n                ]\n            }\n        };\n    },\n    methods: {\n        async getSelfInfo() {\n            const { data: data } = await this.$http.get('/user/');\n            if (data.code !== 20000) {\n                return this.$message.error({\n                    showClose: true,\n                    message: '获取个人信息失败！' + '错误原因：' + data.msg,\n                    offset: 70\n                });\n            }\n\n            this.Info = data.data;\n        },\n        async showEditDialog(username) {\n            this.editForm.username = username;\n            this.editDialogVisible = true;\n        },\n        editDialogClosed() {\n            this.$refs.editFormRef.resetFields();\n        },\n        editUserInfo() {\n            this.$refs.editFormRef.validate(async valid => {\n                if (!valid) return;\n\n                var adddata = new FormData();\n                adddata.append('username', this.editForm.username);\n                if (this.editForm.new_password) {\n                    adddata.append('new_password', this.editForm.new_password);\n                }\n                if (this.editForm.new_nickname) {\n                    adddata.append('new_nickname', this.editForm.new_nickname);\n                }\n                if (this.editForm.new_user_group) {\n                    var num = this.editForm.new_user_group === '超级管理员' ? 1 : 0;\n                    adddata.append('new_user_group', num);\n                }\n                const { data: data } = await this.$http({\n                    url: '/user/',\n                    data: adddata,\n                    method: 'put'\n                });\n                if (data.code !== 20000) {\n                    return this.$message.error({\n                        showClose: true,\n                        message: '修改用户失败！' + '错误原因：' + data.msg,\n                        offset: 70\n                    });\n                }\n                this.$message.success({\n                    showClose: true,\n                    message: '修改用户成功！',\n                    offset: 70\n                });\n                this.editDialogVisible = false;\n                this.getUserList();\n            });\n        }\n    },\n    mounted() {\n        this.getSelfInfo();\n    },\n    created() {\n        this.name = this.$store.state.nickname;\n        this.role = this.$store.state.user_group_name;\n    }\n};\n",{"version":3,"sources":["SelfInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SelfInfo.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n    <div>\n        <div class=\"crumbs\">\n            <el-breadcrumb separator=\"/\">\n                <el-breadcrumb-item> <i class=\"el-icon-user\"></i> 个人信息 </el-breadcrumb-item>\n            </el-breadcrumb>\n        </div>\n        <el-card class=\"bgi mgb20\" shadow=\"hover\" style=\"height:530px;\">\n            <div class=\"user-info\">\n                <img src=\"../../assets/img/4.png\" class=\"user-avator\" alt />\n                <div class=\"user-info-cont\">\n                    <div class=\"user-info-name\">{{ name }}</div>\n                    <div>{{ role }}</div>\n                </div>\n                <el-tooltip effect=\"dark\" content=\"编辑个人信息\" placement=\"top\" :enterable=\"false\">\n                    <el-button type=\"primary\" icon=\"el-icon-edit\" size=\"mini\" @click=\"showEditDialog(name)\"></el-button>\n                </el-tooltip>\n            </div>\n            <div class=\"user-info-list\">\n                账户名：\n                <span>{{ Info.username }}</span>\n            </div>\n            <div class=\"user-info-list\">\n                加入时间：\n                <span>{{ Info.join_datetime | dateFormat }}</span>\n            </div>\n            <div class=\"user-info-list\">\n                上一次登录时间：\n                <span>{{ Info.last_login_datetime | dateFormat }}</span>\n            </div>\n        </el-card>\n        <el-dialog title=\"编辑用户信息\" :visible.sync=\"editDialogVisible\" width=\"50%\" @closed=\"editDialogClosed\">\n            <el-form :model=\"editForm\" :rules=\"editFormRules\" ref=\"editFormRef\" label-width=\"110px\">\n                <el-form-item label=\"用户名\">\n                    <el-input v-model=\"editForm.username\" disabled></el-input>\n                </el-form-item>\n                <el-form-item label=\"密码\" prop=\"new_password\">\n                    <el-input v-model=\"editForm.new_password\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"用户名称\" prop=\"new_nickname\">\n                    <el-input v-model=\"editForm.new_nickname\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"用户权限\" prop=\"new_user_group\" v-if=\"role === '超级管理员'\">\n                    <el-select v-model=\"editForm.new_user_group\" placeholder=\"请选择用户权限\">\n                        <el-option label=\"普通用户\" value=\"普通用户\"></el-option>\n                        <el-option label=\"超级管理员\" value=\"超级管理员\"></el-option>\n                    </el-select>\n                </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"editDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"editUserInfo\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n<script>\nimport qs from 'qs';\nimport fileDownload from 'js-file-download';\nexport default {\n    data() {\n        return {\n            Info: [],\n            name: '',\n            role: '',\n            editDialogVisible: false,\n            editForm: {\n                username: '',\n                new_password: '',\n                new_nickname: '',\n                new_user_group: ''\n            },\n            editFormRules: {\n                username: [\n                    { required: true, message: '请输入用户名', trigger: 'blur' },\n                    {\n                        min: 3,\n                        max: 10,\n                        message: '用户名的长度在3~10个字符之间',\n                        trigger: 'blur'\n                    }\n                ]\n            }\n        };\n    },\n    methods: {\n        async getSelfInfo() {\n            const { data: data } = await this.$http.get('/user/');\n            if (data.code !== 20000) {\n                return this.$message.error({\n                    showClose: true,\n                    message: '获取个人信息失败！' + '错误原因：' + data.msg,\n                    offset: 70\n                });\n            }\n\n            this.Info = data.data;\n        },\n        async showEditDialog(username) {\n            this.editForm.username = username;\n            this.editDialogVisible = true;\n        },\n        editDialogClosed() {\n            this.$refs.editFormRef.resetFields();\n        },\n        editUserInfo() {\n            this.$refs.editFormRef.validate(async valid => {\n                if (!valid) return;\n\n                var adddata = new FormData();\n                adddata.append('username', this.editForm.username);\n                if (this.editForm.new_password) {\n                    adddata.append('new_password', this.editForm.new_password);\n                }\n                if (this.editForm.new_nickname) {\n                    adddata.append('new_nickname', this.editForm.new_nickname);\n                }\n                if (this.editForm.new_user_group) {\n                    var num = this.editForm.new_user_group === '超级管理员' ? 1 : 0;\n                    adddata.append('new_user_group', num);\n                }\n                const { data: data } = await this.$http({\n                    url: '/user/',\n                    data: adddata,\n                    method: 'put'\n                });\n                if (data.code !== 20000) {\n                    return this.$message.error({\n                        showClose: true,\n                        message: '修改用户失败！' + '错误原因：' + data.msg,\n                        offset: 70\n                    });\n                }\n                this.$message.success({\n                    showClose: true,\n                    message: '修改用户成功！',\n                    offset: 70\n                });\n                this.editDialogVisible = false;\n                this.getUserList();\n            });\n        }\n    },\n    mounted() {\n        this.getSelfInfo();\n    },\n    created() {\n        this.name = this.$store.state.nickname;\n        this.role = this.$store.state.user_group_name;\n    }\n};\n</script>\n<style scoped>\n.bgi {\n    background-image: url('../../assets/img/Self_Info_BG3.jpg');\n    background-size: cover;\n    background-position: bottom left;\n}\n.user-info {\n    display: flex;\n    align-items: center;\n    padding-bottom: 20px;\n    border-bottom: 2px solid #ccc;\n    margin-bottom: 20px;\n}\n.user-avator {\n    width: 120px;\n    height: 120px;\n    border-radius: 50%;\n}\n.user-info-cont {\n    padding-left: 50px;\n    flex: 1;\n    font-size: 14px;\n    color: #000;\n}\n.user-info-cont div:first-child {\n    font-size: 30px;\n    color: #222;\n}\n.user-info-list {\n    padding-left: 10px;\n    background-color: rgba(255, 255, 255, 0.4);\n    font-size: 14px;\n    color: #000;\n    line-height: 25px;\n}\n</style>\n"]}]}